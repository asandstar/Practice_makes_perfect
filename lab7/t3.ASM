	DL	EQU		P1.0
	DH	EQU		P1.1
	CLK		EQU		P1.2
	STR		EQU		P1.3
	OE		EQU		P1.4 			;连接的引脚
	
	DHL		EQU		39H		
	DHH		EQU		3AH				;列的串口输出数据
	DLL		EQU		3BH
	DLH		EQU		3CH				;行的串口输出数据
	HANG	EQU		3DH				;输出了几行
	LENG	EQU		3EH		  		;输出了几个字
	NUM		EQU		3FH				;总共输出字数
	TIMES	EQU		40H				;延长定时器时间
	DH		EQU		20H				;存储列的串口输出
	DL		EQU		21H				;存储行的串口输出
	
	AUXR	EQU		8EH

	ORG		0000H
	LJMP	START

	ORG		000BH
	LJMP	TIMER0

	ORG		0100H
START:	
	MOV		SP,#50H
	SETB	ET0
	SETB	EA

	ANL 	AUXR,#7FH		;定时器时钟12T模式
	ANL 	TMOD,#0F0H		;设置定时器模式
	MOV 	TL0,#000H		;设置定时初值
	MOV 	TH0,#04CH		;设置定时初值
	CLR 	TF0				;清除TF0标志
	SETB 	TR0				;定时器0开始计时
		
	CLR		OE				;允许输出
	MOV		LENG,#00H
	MOV		NUM,#02H       ;输出三个字
	MOV		TIMES,#00H		;置初值				
RESET:	
	MOV		HANG,#00H		;输出的行置为0

lOOP:	
	MOV		A,LENG
	MOV		B,#20H
	MUL		AB
	ADD		A,HANG		   	;翻页
	MOV		DPTR,#TAB1
	MOVC	A,@A+DPTR		;查找本行要输出的数据
	CPL		A			   	;DH取反，为了适应高电平有效，可能需要修改
	MOV		DHL,A

	MOV		A,HANG
   	MOV		DPTR,#HANGTAB
	MOVC	A,@A+DPTR		;查找输出哪一行
	MOV		DLL,A

	INC		HANG

	MOV		A,LENG
	MOV		B,#20H
	MUL		AB
	ADD		A,HANG
	MOV		DPTR,#TAB1
	MOVC	A,@A+DPTR
	CPL		A				 ;DH取反，为了适应高电平有效
	MOV		DHH,A

	MOV		A,HANG
   	MOV		DPTR,#HANGTAB
	MOVC	A,@A+DPTR
	MOV		DLH,A

	INC		HANG			;换下一行

	LCALL	PRINT

	MOV		A,HANG
	CJNE	A,#20H,LOOP	;16行还没输出完则接着输出下一行
	SJMP	RESET			;16行输出完了则从0行开始输出

PRINT:	;依次输出每一行数据，并选通该行
	CLR		STR
	
	MOV		DH,DHH
	MOV		DL,DLH
	CLR		CLK
	MOV		C,DH.0
	MOV		DH,C
	MOV		C,DL.7
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.1
	MOV		DH,C
	MOV		C,DL.6
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.2
	MOV		DH,C
	MOV		C,DL.5
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.3
	MOV		DH,C
	MOV		C,DL.4
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.4
	MOV		DH,C
	MOV		C,DL.3
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.5
	MOV		DH,C
	MOV		C,DL.2
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.6
	MOV		DH,C
	MOV		C,DL.1
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.7
	MOV		DH,C
	MOV		C,DL.0
	MOV		DL,C
	SETB	CLK

	MOV		DH,DHL
	MOV		DL,DLL

	CLR		CLK
	MOV		C,DH.0
	MOV		DH,C
	MOV		C,DL.7
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.1
	MOV		DH,C
	MOV		C,DL.6
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.2
	MOV		DH,C
	MOV		C,DL.5
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.3
	MOV		DH,C
	MOV		C,DL.4
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.4
	MOV		DH,C
	MOV		C,DL.3
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.5
	MOV		DH,C
	MOV		C,DL.2
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.6
	MOV		DH,C
	MOV		C,DL.1
	MOV		DL,C
	SETB	CLK

	CLR		CLK
	MOV		C,DH.7
	MOV		DH,C
	MOV		C,DL.0
	MOV		DL,C
	SETB	CLK
	CLR		CLK
	
	SETB	STR

	RET

TIMER0:
	INC		TIMES		

	PUSH	ACC
	MOV		A,TIMES
	CJNE	A,#30H,BACK_TIMER0		;定时器溢出30次才翻页
	MOV		TIMES,#00H
	MOV		A,LENG
	CJNE	A,NUM,NEXT_TIMER0		
	MOV		LENG,#0FFH				;到了最后一页页数置0FFH
NEXT_TIMER0:
	INC		LENG					;页数加1
BACK_TIMER0:
	POP		ACC
	RETI

	ORG		0300H
HANGTAB:;行选择表
	DB 01H,00H,02H,00H,04H,00H,08H,00H,10H,00H,20H,00H,40H,00H,80H,00H
	DB 0H,01H,00H,02H,00H,04H,00H,08H,00H,10H,00H,20H,00H,40H,00H,80H

TAB1:	
	DB 000H,000H,000H,000H,000H,000H,000H,000H,003H,080H,006H,0C0H,004H,060H,006H,030H;
	DB 002H,030H,006H,060H,006H,0C0H,003H,080H,000H,000H,000H,000H,000H,000H,000H,000H;
TAB2:
	DB 000H,000H,000H,000H,007H,000H,00DH,0C0H,018H,060H,018H,020H,008H,030H,00CH,01CH;
	DB 00CH,018H,008H,030H,008H,060H,018H,0C0H,00FH,080H,003H,000H,000H,000H,000H,000H;
TAB3:
	DB 000H,000H,00FH,000H,019H,0C0H,030H,060H,020H,030H,020H,018H,010H,00CH,018H,006H;
	DB 018H,00EH,030H,018H,020H,030H,030H,060H,010H,0C0H,00FH,080H,000H,000H,000H,000H;

//TAB1:	;每行的内容选择表
//	DB 00H 00H 00H 00H 00H F2H 54H 58H 5EH 58H 54H F2H 00H 00H 00H 00H;
//	DB 00H 00H 00H 00H 00H 3FH 01H 01H 01H 09H 11H 3FH 00H 00H 00H 00H;
//TAB2:	
//	DB 00H 00H 20H 40H F0H 40H 20H 00H E8H 28H 28H F8H 28H 28H E8H 00H;
//	DB 00H 00H 08H 04H 03H 04H 08H 00H 1FH 02H 01H 00H 01H 0AH 1FH 00H;
//TAB3:
//	DB 00H 20H 20H FCH 20H 20H E8H 28H 68H B8H 28H ACH 6AH 28H E8H 00H;
//	DB 00H 02H 01H 3FH 01H 02H 3FH 00H 09H 09H 3FH 09H 09H 10H 3FH 00H;
	END
