;保底,实现了功能但没完全满足要求
/*2.初态显示小数点，有键（外部中断方式）参与，数码管静态显示：8个数码管根据按键同时显示键值*/

	ORG 0000H  
	LJMP MAIN

	ORG 0100H  
KEYTAB:
	DB 07EH,0BEH,0DEH,0EEH	;3,2,1,0
	DB 07DH,0BDH,0DDH,0EDH	;7,6,5,4
	DB 07BH,0BBH,0DBH,0EBH	;B,A,9,8
	DB 077H,0B7H,0D7H,0E7H	;F,E,D,C

CODETAB:    
	DB 03FH, 006H, 05BH, 04FH, 066H, 06DH, 07DH, 007H  ;01234567
	DB 07FH, 06FH, 077H, 07CH, 039H, 05EH, 079H, 071H  ;89abcdef
	
	ORG 0200H  
MAIN:       
	MOV 91H,#0  
	MOV 92H,#0FFH  
	MOV 93H,#0  
	MOV 94H,#0FFH  
	MOV 95H,#0  
	MOV 96H,#0FFH 
	MOV P2,#00H
	MOV P0,#80H 

LOOP:       
	MOV P1,#0F0H  
	MOV A,P1  
	CJNE A,#0F0H,SCAN  
	LJMP LOOP 
	
	 
SCAN:       
	ACALL DELAY10MS  
	MOV P1,#0FEH  
	MOV A,P1  
	CJNE A,#0FEH, FIND  
	MOV P1,#0FDH  
	MOV A,P1  
	CJNE A,#0FDH,FIND  
	MOV P1,#0FBH  
	MOV A,P1  
	CJNE A,#0FBH,FIND  
	MOV P1,#0F7H  
	MOV A,P1  
	CJNE A,#0F7H,FIND  
	LJMP LOOP  

FIND:       
	MOV B,A  
	MOV DPTR,#KEYTAB  
	MOV R7,#0FFH  
BACK:       
	INC R7  
	MOV A,R7  
	MOVC A,@A+DPTR  
	CJNE A,B,BACK  
DUANMA:  
	MOV DPTR, #CODETAB  
	MOV A,R7  
	MOVC A,@A+DPTR  
	MOV R6,A  

OUT:        
	MOV P2,#00H  
	MOV P0,R6  
	LJMP LOOP  

DELAY10MS:          ;@11.0592MHz  
	NOP  
	NOP  
	NOP  
	PUSH 30H  
	PUSH 31H  
	MOV 30H,#87  
	MOV 31H,#10  
NEXT:  
	DJNZ 31H,NEXT  
	DJNZ 30H,NEXT  
	POP 31H  
	POP 30H  
	RET  

DELAY1MS:           ;@11.0592MHz  
	PUSH 30H  
	PUSH 31H  
	MOV 30H,#9  
	MOV 31H,#150  
NEXT1:  
	DJNZ 31H,NEXT1  
	DJNZ 30H,NEXT1  
	POP 31H  
	POP 30H  
	RET  
	END
